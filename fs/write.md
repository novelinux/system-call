write
========================================

* function

```
write
 |
sys_write
 |
 +-> fdget_pos (fd --> struct fd)
 |
 +-> file_pos_read
 |
 +-> vfs_write -> __vfs_write -> new_sync_write -+
 | filp->f_op_write_iter         <----        <--+
 | |
 | ext4_file_write_iter
 | |
 | +-> __generic_file_write_iter
 | |   |
 | |   generic_perform_write
 | |   |
 | |   +-> aops->write_begin
 | |   |
 | |   +-> ext4_da_write_begin
 | |   |   |
 | |   |   +-file encrypt-> ext4_block_write_begin
 | |   |   |
 | |   |   +-> __block_write_begin
 | |   |
 | |   +-> aops->write_end -> ext4_da_write_end
 | |
 | +-> generic_write_sync -> vfs_sync_range -+
 +-> file_pos_write          |
   ext4_sync_file          <-+
   |
   generic_file_fsync
   |
   __generic_file_fsync
   |
   filemap_write_and_wait_range
   |
   filemap_fdatawrite
   |
   __filemap_fdatawrite
   |
   __filemap_fdatawrite_range
   |
   do_writepages
   |
   ext4_writepages
   |
   mpage_prepare_extent_to_map
   |
   mpage_process_page_bufs
   |
   mpage_submit_page
   |
   ext4_bio_write_page -> ext4_encrypt
```

* data structure

```
fd -> struct fd -+
                 |
  struct file  <-+
  |
  +-> struct path
  |   |
  |   +-> struct vfsmount -+-> struct super_block
  |   |                    |
  |   +-> struct dentry  <-+
  |                   |
  +-> struct inode  <-+-> struct qstr (d_name)
  |         +         |
  |         |         +-> struct dentry (d_parent)
  |         +
  +-> struct address_space
```

write
----------------------------------------

path: bionic/libc/arch-arm/syscalls/write.S
```
/* Generated by gensyscalls.py. Do not edit. */

#include <private/bionic_asm.h>

ENTRY(write)
    mov     ip, r7
    ldr     r7, =__NR_write
    swi     #0
    mov     r7, ip
    cmn     r0, #(MAX_ERRNO + 1)
    bxls    lr
    neg     r0, r0
    b       __set_errno_internal
END(write)
```

sys_write
----------------------------------------

最终通过系统调用会切换到内核态调用sys_write函数.

https://github.com/novelinux/linux-4.x.y/tree/master/fs/read_write.c/sys_write.md

samples
----------------------------------------

https://github.com/novelinux/linux-4.x.y/tree/master/samples/fs/test_write/README.md
